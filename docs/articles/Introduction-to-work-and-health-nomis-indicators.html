<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Work and Health Indicators with nomisr • nomisr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Work and Health Indicators with nomisr">
<meta property="og:description" content="nomisr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90706059-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-90706059-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nomisr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://docs.evanodell.com">Docs Home</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/introduction.html">Introduction</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://docs.evanodell.com">Documentation Home</a>
    </li>
    <li class="divider">
    <li>
      <a href="https://docs.evanodell.com/hansard">hansard</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/mnis">mnis</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/parlitools">parlitools</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/nomisr">nomisr</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/fixerapi">fixerapi</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/refuge">refuge</a>
    </li>
    <li>
      <a href="https://docs.evanodell.com/emisc">emisc</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/nomisr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://evanodell.com">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Introduction-to-work-and-health-nomis-indicators_files/header-attrs-2.2/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Work and Health Indicators with nomisr</h1>
                        <h4 class="author">Nina Robery</h4>
            
            <h4 class="date">6 May 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/nomisr/blob/master/../docs/vignettes/Introduction-to-work-and-health-nomis-indicators.Rmd"><code>../docs/vignettes/Introduction-to-work-and-health-nomis-indicators.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction-to-work-and-health-nomis-indicators.Rmd</code></div>

    </div>

    
    
<div id="introduction-to-some-of-the-outputs-that-can-be-created-using-nomisr" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-to-some-of-the-outputs-that-can-be-created-using-nomisr" class="anchor"></a>Introduction to some of the outputs that can be created using nomisr</h1>
<p>The nomisr package is an easy way to obtain data from Nomis. In this introduction you can see some of the functionality of the tool to create bespoke charts. These charts use Bolton as the area of interest.</p>
<div id="querying-data-availability" class="section level2">
<h2 class="hasAnchor">
<a href="#querying-data-availability" class="anchor"></a>Querying data availability</h2>
<p>The first step is to understanding what datasets are available in <code>nomisr</code> and this can be done using the <code>nomis_get_info()</code> function. If no particular id is inputted inside the brackets, the command will return all available datasets.</p>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">nomis_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_data_info.html">nomis_data_info</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">id</span>, <span class="no">description.value</span>, <span class="no">name.value</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">nomis_data</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 3
##   id     description.value                         name.value                   
##   &lt;chr&gt;  &lt;chr&gt;                                     &lt;chr&gt;                        
## 1 NM_1_1 Records the number of people claiming Jo… Jobseeker's Allowance with r…
## 2 NM_2_1 A quartery count of claimants who were c… claimant count - age and dur…
## 3 NM_4_1 A monthly count of Jobseeker's Allowance… Jobseeker's Allowance by age…
## 4 NM_5_1 A midyear estimate of the workforce (the… claimant count denominators …
## 5 NM_6_1 A quarterly count of  Jobseeker's Allowa… claimant count - occupation  
## 6 NM_7_1 A quarterly count of  Jobseeker's Allowa… claimant count - occupation,…</code></pre>
<p>This gives you a list of all available datasets in nomis. The list of ids/datasets used in this script are:</p>
<ul>
<li><p>NM_17_5 (Annual Population Survey (APS): contains data on the working age population, economic activity &amp; inactivity)</p></li>
<li><p>NM_134_1 (Benefit Claimants - Employment and Support Allowance (ESA): contains data on ICDGP condition by ESA)</p></li>
</ul>
<p>If you wanted to look at more information on a specific dataset, you can add this inside the bracket of the <code>nomis_get_info()</code> function or use the <code><a href="../reference/nomis_get_metadata.html">nomis_get_metadata()</a></code> function. Both of these will provide you with the different options (concepts) available for your chosen dataset.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">NM_17_5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_data_info.html">nomis_data_info</a></span>(<span class="st">"NM_17_5"</span>)
<span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(<span class="no">NM_17_5</span>)</pre></body></html></div>
<pre><code>## Rows: 1
## Columns: 14
## $ agencyid                             &lt;chr&gt; "NOMIS"
## $ id                                   &lt;chr&gt; "NM_17_5"
## $ uri                                  &lt;chr&gt; "Nm-17d5"
## $ version                              &lt;dbl&gt; 1
## $ annotations.annotation               &lt;list&gt; [&lt;data.frame[9 x 2]&gt;]
## $ components.attribute                 &lt;list&gt; [&lt;data.frame[7 x 4]&gt;]
## $ components.dimension                 &lt;list&gt; [&lt;data.frame[4 x 3]&gt;]
## $ components.primarymeasure.conceptref &lt;chr&gt; "OBS_VALUE"
## $ components.timedimension.codelist    &lt;chr&gt; "CL_17_5_TIME"
## $ components.timedimension.conceptref  &lt;chr&gt; "TIME"
## $ description.value                    &lt;chr&gt; "A residence based labour market…
## $ description.lang                     &lt;chr&gt; "en"
## $ name.value                           &lt;chr&gt; "annual population survey (varia…
## $ name.lang                            &lt;chr&gt; "en"</code></pre>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">NM_17_5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="st">"NM_17_5"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">NM_17_5</span>)</pre></body></html></div>
<pre><code>## # A tibble: 5 x 3
##   codelist          conceptref isfrequencydimension
##   &lt;chr&gt;             &lt;chr&gt;      &lt;chr&gt;               
## 1 CL_17_5_GEOGRAPHY GEOGRAPHY  false               
## 2 CL_17_5_VARIABLE  VARIABLE   false               
## 3 CL_17_5_MEASURES  MEASURES   false               
## 4 CL_17_5_FREQ      FREQ       true                
## 5 CL_17_5_TIME      TIME       false</code></pre>
</div>
<div id="querying-data-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#querying-data-variables" class="anchor"></a>Querying data variables</h2>
<div id="getting-concepts" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-concepts" class="anchor"></a>Getting concepts:</h3>
<p>As mentioned previously, the <code>nomis_get_info()</code> and <code><a href="../reference/nomis_get_metadata.html">nomis_get_metadata()</a></code> functions will provide you with a list of concepts that we can explore further to see what data is available e.g. dates, measures, geographies and variables. The concepts will differ depending on your chosen dataset, so it is a good idea to run the <code><a href="../reference/nomis_get_metadata.html">nomis_get_metadata()</a></code> for each new dataset you are looking at.</p>
<p>To explore the concepts we need to specify this in the code. For example to explore the dates available in the APS dataset, we need to specify the concept as “time”.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">NM_17_5_DATES</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"time"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(<span class="no">NM_17_5_DATES</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 3
##   id      label.en          description.en   
##   &lt;chr&gt;   &lt;chr&gt;             &lt;chr&gt;            
## 1 2018-09 Oct 2017-Sep 2018 Oct 2017-Sep 2018
## 2 2018-12 Jan 2018-Dec 2018 Jan 2018-Dec 2018
## 3 2019-03 Apr 2018-Mar 2019 Apr 2018-Mar 2019
## 4 2019-06 Jul 2018-Jun 2019 Jul 2018-Jun 2019
## 5 2019-09 Oct 2018-Sep 2019 Oct 2018-Sep 2019
## 6 2019-12 Jan 2019-Dec 2019 Jan 2019-Dec 2019</code></pre>
<p>Instead of referring to the ids for the specific dates you can also use the following options:</p>
<ul>
<li>latest - latest available data</li>
<li>previous - the date prior to the latest</li>
<li>previousMINUS2 etc. - two quarters ago</li>
<li>prevyear - the date one year prior to the latest</li>
<li>first - the oldest available data for the dataset</li>
</ul>
<p>To explore the variables available in the APS dataset, we need to specify the concept as “variable”.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">NM_17_5_VARIABLE</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"variable"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">NM_17_5_VARIABLE</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 3
##   id    label.en                            description.en                      
##   &lt;chr&gt; &lt;chr&gt;                               &lt;chr&gt;                               
## 1 1     % of all people aged 16+ who are m… % of all people aged 16+ who are ma…
## 2 2     % of all people aged 16+ who are f… % of all people aged 16+ who are fe…
## 3 3     % of all people aged 16+ who are a… % of all people aged 16+ who are ag…
## 4 4     % of males aged 16+ who are aged 1… % of males aged 16+ who are aged 16…
## 5 5     % of females aged 16+ who are aged… % of females aged 16+ who are aged …
## 6 6     % of aged 16-64 who are male        % of aged 16-64 who are male</code></pre>
<p>To have a look at what geographies are available in the APS dataset, we need to specify the concept as “geography”.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">NM_17_5_GEOG</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"geography"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">NM_17_5_GEOG</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 4
##   id         parentCode label.en         description.en  
##   &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;           
## 1 2092957697 &lt;NA&gt;       United Kingdom   United Kingdom  
## 2 2092957698 &lt;NA&gt;       Great Britain    Great Britain   
## 3 2092957699 &lt;NA&gt;       England          England         
## 4 2092957700 2092957700 Wales            Wales           
## 5 2092957701 2092957701 Scotland         Scotland        
## 6 2092957702 2092957702 Northern Ireland Northern Ireland</code></pre>
<p>This gives the top level geographies available but if we wanted to identify what type of geographies are available, we would need to use ‘type’ in the code.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">NM_17_5_GEOG</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"geography"</span>, <span class="st">"type"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">NM_17_5_GEOG</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 3
##   id      label.en                           description.en                     
##   &lt;chr&gt;   &lt;chr&gt;                              &lt;chr&gt;                              
## 1 TYPE83  jobcentre plus group as of April … jobcentre plus group as of April 2…
## 2 TYPE84  jobcentre plus district as of Apr… jobcentre plus district as of Apri…
## 3 TYPE225 major towns and cities             major towns and cities             
## 4 TYPE231 2011 scottish datazones            2011 scottish datazones            
## 5 TYPE232 2011 scottish intermediate zones   2011 scottish intermediate zones   
## 6 TYPE241 scottish parliamentary regions     scottish parliamentary regions</code></pre>
<p>If you wanted all local authorities, combined authorities and regions in England, it is easier to create a vector which you can then feed into the <code><a href="../reference/nomis_get_data.html">nomis_get_data()</a></code> function.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">EN_LAs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"geography"</span>,
                             <span class="kw">type</span> <span class="kw">=</span> <span class="st">"TYPE464"</span>)[<span class="fl">1</span>:<span class="fl">326</span>, ] <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fl">464</span>)
<span class="no">EN_CAs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"geography"</span>,
                             <span class="kw">type</span> <span class="kw">=</span> <span class="st">"TYPE442"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fl">442</span>)
<span class="no">EN_Regions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"geography"</span>,
                                 <span class="kw">type</span> <span class="kw">=</span> <span class="st">"TYPE480"</span>)[<span class="fl">1</span>:<span class="fl">9</span>, ] <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fl">480</span>)
<span class="no">EN_Country</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_metadata.html">nomis_get_metadata</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">concept</span> <span class="kw">=</span> <span class="st">"geography"</span>,
                                 <span class="kw">type</span> <span class="kw">=</span> <span class="st">"TYPE499"</span>)[<span class="fl">3</span>, ] <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fl">499</span>)

<span class="co"># use rbind to combine all of the above objects together to create a single object containing all geographies of interest and select only the id, parentCode, label.en and type  </span>
<span class="no">EN_geos</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">EN_LAs</span>, <span class="no">EN_CAs</span>, <span class="no">EN_Regions</span>, <span class="no">EN_Country</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">id</span>, <span class="no">parentCode</span>, <span class="no">label.en</span>, <span class="no">type</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">EN_geos</span>)</pre></body></html></div>
<pre><code>## # A tibble: 346 x 4
##    id         parentCode label.en              type
##    &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;                &lt;dbl&gt;
##  1 1946157057 2013265921 Darlington             464
##  2 1946157058 2013265921 County Durham          464
##  3 1946157059 2013265921 Hartlepool             464
##  4 1946157060 2013265921 Middlesbrough          464
##  5 1946157061 2013265921 Northumberland         464
##  6 1946157062 2013265921 Redcar and Cleveland   464
##  7 1946157063 2013265921 Stockton-on-Tees       464
##  8 1946157064 2013265921 Gateshead              464
##  9 1946157065 2013265921 Newcastle upon Tyne    464
## 10 1946157066 2013265921 North Tyneside         464
## # … with 336 more rows</code></pre>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># Save it as a vector so can plug it into nomis_get_data function</span>
<span class="no">EN_geographies</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1946157057</span>:<span class="fl">1946157382</span>, <span class="fl">1853882369</span>:<span class="fl">1853882372</span>,
                    <span class="fl">1853882374</span>:<span class="fl">1853882379</span>, <span class="fl">2013265921</span>:<span class="fl">2013265929</span>, <span class="fl">2092957699</span>)</pre></body></html></div>
</div>
</div>
<div id="downloading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-data" class="anchor"></a>Downloading data</h2>
<p>Now you have enough information to use the nomis_get_data function.</p>
<ul>
<li>Step 1: specify the id/dataset of interest - in this example the NM_17_5 (APS) dataset is used</li>
<li>Step 2: set the year of interest - in this example the date has been set to ‘latest’ available</li>
<li>Step 3: select geography of interest - in this example the vector ‘EN_geographies’ created earlier is used</li>
<li>Step 4: select the variable(s) of interest - in this example the working age population aged 16-64 years [id = 18] has been selected</li>
<li>Step 5: select the measures of interest - in this example all measures available are pulled</li>
</ul>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">working_age_pop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                                  <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>,
                                  <span class="kw">variable</span> <span class="kw">=</span> <span class="fl">18</span>,
                                  <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>))</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">working_age_pop</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1,384 x 28
##    DATE  DATE_NAME DATE_CODE DATE_TYPE DATE_TYPECODE DATE_SORTORDER GEOGRAPHY
##    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
##  1 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  2 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  3 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  4 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  5 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  6 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  7 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  8 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
##  9 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
## 10 2019… Jan 2019… 2019-12   date                  0              0    1.95e9
## # … with 1,374 more rows, and 21 more variables: GEOGRAPHY_NAME &lt;chr&gt;,
## #   GEOGRAPHY_CODE &lt;chr&gt;, GEOGRAPHY_TYPE &lt;chr&gt;, GEOGRAPHY_TYPECODE &lt;dbl&gt;,
## #   GEOGRAPHY_SORTORDER &lt;dbl&gt;, VARIABLE &lt;dbl&gt;, VARIABLE_NAME &lt;chr&gt;,
## #   VARIABLE_CODE &lt;dbl&gt;, VARIABLE_TYPE &lt;chr&gt;, VARIABLE_TYPECODE &lt;dbl&gt;,
## #   VARIABLE_SORTORDER &lt;dbl&gt;, MEASURES &lt;dbl&gt;, MEASURES_NAME &lt;chr&gt;,
## #   OBS_VALUE &lt;dbl&gt;, OBS_STATUS &lt;chr&gt;, OBS_STATUS_NAME &lt;chr&gt;, OBS_CONF &lt;lgl&gt;,
## #   OBS_CONF_NAME &lt;chr&gt;, URN &lt;chr&gt;, RECORD_OFFSET &lt;dbl&gt;, RECORD_COUNT &lt;dbl&gt;</code></pre>
<div id="stacked-bar-chart-showing-labour-market-summary-for-bolton" class="section level3">
<h3 class="hasAnchor">
<a href="#stacked-bar-chart-showing-labour-market-summary-for-bolton" class="anchor"></a>Stacked bar chart showing labour market summary for Bolton</h3>
<p>The following steps show how to make a stacked bar chart, which will show:</p>
<p>Stack 1: working age population</p>
<ul>
<li>Economic activity rate - aged 16-64 [id=18]</li>
</ul>
<p>Stack 2: economically active and economically inactive</p>
<ul>
<li>Unemployment rate - aged 16-64 (economically active will be the denominator) [id=84]</li>
<li>% who are economically inactive - aged 16-64 [id=111]</li>
</ul>
<p>Stack 3: employed, unemployed, want a job, don’t want a job</p>
<ul>
<li>Employment rate - aged 16-64 [id=45]</li>
<li>Unemployment rate - aged 16-64 [id=84]</li>
<li>% of economically inactive who want a job [id=1487]</li>
<li>% of economically inactive who do not want a job [id=1488]</li>
</ul>
<p>Stack 4: economically active, long term sick, temp sick, student, looking after family/home, retired, other, discouraged</p>
<ul>
<li>Unemployment rate - aged 16-64 (economically active will be the denominator) [id=84]</li>
<li>% of economically inactive student [id=1493]</li>
<li>% of economically inactive looking after family/home [id=1494]</li>
<li>% of economically inactive temporary sick [id=1495]</li>
<li>% of economically inactive long-term sick [id=1496]</li>
<li>% of economically inactive discouraged [id=1497]</li>
<li>% of economically inactive retired [id=1498]</li>
<li>% of economically inactive other [id=1499]</li>
</ul>
<p>The data extracted is for all of the geographies outlined in the ‘EN_geographies’ vector, but the chart is filtered for Bolton only.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="co"># FIRST STACK: Working age population</span>

<span class="co"># Need to extract the denominator from our previously created working_age_pop dataframe:</span>
<span class="no">first_stack</span> <span class="kw">&lt;-</span> <span class="no">working_age_pop</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Denominator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">grouping</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co"># replace na with 0</span>
<span class="no">first_stack</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">first_stack</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">first_stack</span>)</pre></body></html></div>
<pre><code>## # A tibble: 346 x 7
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE VARIABLE_NAME OBS_VALUE
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;             &lt;dbl&gt;
##  1 Jan 2019…    1.95e9 Darlington     E06000005      Economic act…     63600
##  2 Jan 2019…    1.95e9 County Durham  E06000047      Economic act…    324400
##  3 Jan 2019…    1.95e9 Hartlepool     E06000001      Economic act…     56300
##  4 Jan 2019…    1.95e9 Middlesbrough  E06000002      Economic act…     88400
##  5 Jan 2019…    1.95e9 Northumberland E06000057      Economic act…    183400
##  6 Jan 2019…    1.95e9 Redcar and Cl… E06000003      Economic act…     80500
##  7 Jan 2019…    1.95e9 Stockton-on-T… E06000004      Economic act…    120600
##  8 Jan 2019…    1.95e9 Gateshead      E08000037      Economic act…    127800
##  9 Jan 2019…    1.95e9 Newcastle upo… E08000021      Economic act…    199600
## 10 Jan 2019…    1.95e9 North Tyneside E08000022      Economic act…    127600
## # … with 336 more rows, and 1 more variable: grouping &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="co"># SECOND STACK: Economically active and economically inactive</span>

<span class="co"># Extract economically active variable:</span>
<span class="no">econ_active</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                              <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>,
                              <span class="kw">variable</span> <span class="kw">=</span> <span class="fl">84</span>,
                              <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Denominator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">VARIABLE_NAME</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">VARIABLE_NAME</span> <span class="kw">=</span> <span class="st">"economically active"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="co"># Extract economically inactive variable:</span>
<span class="no">econ_inactive</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                                <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">variable</span> <span class="kw">=</span> <span class="fl">111</span>,
                                <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Numerator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )
## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="co"># Bind the econ_active and econ_inactive datasets together to create the second stack:</span>
<span class="no">second_stack</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">econ_active</span>, <span class="no">econ_inactive</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">grouping</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="co"># replace na with 0</span>
<span class="no">second_stack</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">second_stack</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">second_stack</span>)</pre></body></html></div>
<pre><code>## # A tibble: 692 x 7
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE VARIABLE_NAME OBS_VALUE
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;             &lt;dbl&gt;
##  1 Jan 2019…    1.85e9 Greater Manch… E47000001      economically…   1367400
##  2 Jan 2019…    1.85e9 Greater Manch… E47000001      % who are ec…    417500
##  3 Jan 2019…    1.85e9 Sheffield Cit… E47000002      economically…    679000
##  4 Jan 2019…    1.85e9 Sheffield Cit… E47000002      % who are ec…    202400
##  5 Jan 2019…    1.85e9 West Yorkshire E47000003      economically…   1100200
##  6 Jan 2019…    1.85e9 West Yorkshire E47000003      % who are ec…    351700
##  7 Jan 2019…    1.85e9 Liverpool Cit… E47000004      economically…    735000
##  8 Jan 2019…    1.85e9 Liverpool Cit… E47000004      % who are ec…    231500
##  9 Jan 2019…    1.85e9 Tees Valley    E47000006      economically…    300800
## 10 Jan 2019…    1.85e9 Tees Valley    E47000006      % who are ec…    108600
## # … with 682 more rows, and 1 more variable: grouping &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="co"># THIRD STACK: Employed, unemployed, want a job, don't want a job</span>

<span class="co"># Extract employed variable:</span>
<span class="no">employed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                           <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">variable</span> <span class="kw">=</span> <span class="fl">45</span>,
                           <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Numerator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )
## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># Extract unemployed variable:</span>
<span class="no">unemployed</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                             <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">variable</span> <span class="kw">=</span> <span class="fl">84</span>,
                             <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Numerator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )
## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="co"># Extract want a job variable:</span>
<span class="no">want_job</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                           <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">variable</span> <span class="kw">=</span> <span class="fl">1487</span>,
                           <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Numerator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )
## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="co"># Extract don't want a job variable:</span>
<span class="no">dont_want_job</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                                <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">variable</span> <span class="kw">=</span> <span class="fl">1488</span>,
                                <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Numerator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )
## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="co"># Bind datasets together to create third stack:</span>
<span class="no">third_stack</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">employed</span>, <span class="no">unemployed</span>, <span class="no">want_job</span>, <span class="no">dont_want_job</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">grouping</span> <span class="kw">=</span> <span class="fl">3</span>)

<span class="co"># replace na with 0</span>
<span class="no">third_stack</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">third_stack</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">third_stack</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1,384 x 7
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE VARIABLE_NAME OBS_VALUE
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;             &lt;dbl&gt;
##  1 Jan 2019…    1.85e9 Greater Manch… E47000001      Employment r…   1297600
##  2 Jan 2019…    1.85e9 Greater Manch… E47000001      Unemployment…     69800
##  3 Jan 2019…    1.85e9 Greater Manch… E47000001      % of economi…     76000
##  4 Jan 2019…    1.85e9 Greater Manch… E47000001      % of economi…    341500
##  5 Jan 2019…    1.85e9 Sheffield Cit… E47000002      Employment r…    642900
##  6 Jan 2019…    1.85e9 Sheffield Cit… E47000002      Unemployment…     36100
##  7 Jan 2019…    1.85e9 Sheffield Cit… E47000002      % of economi…     56900
##  8 Jan 2019…    1.85e9 Sheffield Cit… E47000002      % of economi…    145500
##  9 Jan 2019…    1.85e9 West Yorkshire E47000003      Employment r…   1050100
## 10 Jan 2019…    1.85e9 West Yorkshire E47000003      Unemployment…     50100
## # … with 1,374 more rows, and 1 more variable: grouping &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="co"># FOURTH STACK: Economically active, LT sick, temp sick, student, looking after family/home, retired, other, discouraged</span>

<span class="co"># For the fourth stack you don't want the econ active shown so bind with missing variable name dataset:</span>
<span class="no">econ_active_missing</span> <span class="kw">&lt;-</span> <span class="no">econ_active</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">Active</span> <span class="kw">=</span> <span class="st">""</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>: <span class="no">GEOGRAPHY_CODE</span>, <span class="no">Active</span>, <span class="no">OBS_VALUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">rename</span>(<span class="kw">VARIABLE_NAME</span> <span class="kw">=</span> <span class="no">Active</span>)

<span class="co"># Extract reasons variables:</span>
<span class="no">reasons</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                          <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">variable</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1493</span>:<span class="fl">1499</span>),
                          <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Numerator"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>,
         <span class="no">VARIABLE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )
## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="co"># Bind two datasets together to create the fourth stack:</span>
<span class="no">fourth_stack</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">econ_active_missing</span>, <span class="no">reasons</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">grouping</span> <span class="kw">=</span> <span class="fl">4</span>)

<span class="co"># replace na with 0</span>
<span class="no">fourth_stack</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">fourth_stack</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">fourth_stack</span>)</pre></body></html></div>
<pre><code>## # A tibble: 2,768 x 7
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE VARIABLE_NAME OBS_VALUE
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;             &lt;dbl&gt;
##  1 Jan 2019…    1.85e9 Greater Manch… E47000001      ""              1367400
##  2 Jan 2019…    1.85e9 Greater Manch… E47000001      "% of econom…    124200
##  3 Jan 2019…    1.85e9 Greater Manch… E47000001      "% of econom…     97100
##  4 Jan 2019…    1.85e9 Greater Manch… E47000001      "% of econom…      7900
##  5 Jan 2019…    1.85e9 Greater Manch… E47000001      "% of econom…    108100
##  6 Jan 2019…    1.85e9 Greater Manch… E47000001      "% of econom…      2100
##  7 Jan 2019…    1.85e9 Greater Manch… E47000001      "% of econom…     40800
##  8 Jan 2019…    1.85e9 Greater Manch… E47000001      "% of econom…     37300
##  9 Jan 2019…    1.85e9 Sheffield Cit… E47000002      ""               679000
## 10 Jan 2019…    1.85e9 Sheffield Cit… E47000002      "% of econom…     54200
## # … with 2,758 more rows, and 1 more variable: grouping &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="co"># Have all the data to make the stacked bar chart - now to bind the datasets together </span>
<span class="no">stacked_bar</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">first_stack</span>, <span class="no">second_stack</span>, <span class="no">third_stack</span>, <span class="no">fourth_stack</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="no">grouping</span>, <span class="no">OBS_VALUE</span>))

<span class="co">## Filter to area of interest - Enter geographical code for area of interest e.g. "E08000001" for Bolton </span>
<span class="no">area_of_interest_code</span> <span class="kw">&lt;-</span> <span class="st">"E08000001"</span>

<span class="co"># Filter to area:</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">stacked_bar</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">GEOGRAPHY_CODE</span> <span class="kw">==</span> <span class="no">area_of_interest_code</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">Key</span> <span class="kw">=</span> <span class="no">VARIABLE_NAME</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">VARIABLE_NAME</span>)

<span class="no">area_of_interest_name</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">data</span>[<span class="fl">1</span>,<span class="st">"GEOGRAPHY_NAME"</span>])

<span class="co"># Sort out category names:</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"Economic activity rate - aged 16-64"</span>] <span class="kw">&lt;-</span> <span class="st">"1. Working age population"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% who are economically inactive - aged 16-64"</span>] <span class="kw">&lt;-</span> <span class="st">"2b. Economically inactive"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"economically active"</span>] <span class="kw">&lt;-</span> <span class="st">"2a. Economically active"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"Employment rate - aged 16-64"</span>] <span class="kw">&lt;-</span> <span class="st">"3a. Employed"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"Unemployment rate - aged 16-64"</span>] <span class="kw">&lt;-</span> <span class="st">"3b. Unemployed"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive who want a job"</span>] <span class="kw">&lt;-</span> <span class="st">"3c. Want a job"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive who do not want a job"</span>] <span class="kw">&lt;-</span> <span class="st">"3d. Don't want a job"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive long-term sick"</span>] <span class="kw">&lt;-</span> <span class="st">"4a. Long-term sick"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive temporary sick"</span>] <span class="kw">&lt;-</span> <span class="st">"4b. Temporary sick"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive student"</span>] <span class="kw">&lt;-</span> <span class="st">"4c. Student"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive looking after family/home"</span>] <span class="kw">&lt;-</span> <span class="st">"4d. Looking after family/home"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive retired"</span>] <span class="kw">&lt;-</span> <span class="st">"4e. Retired"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive other"</span>] <span class="kw">&lt;-</span> <span class="st">"4f. Other"</span>
<span class="no">data</span>$<span class="no">Key</span>[<span class="no">data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% of economically inactive discouraged"</span>] <span class="kw">&lt;-</span> <span class="st">"4g. Discouraged"</span>

<span class="co"># Get 15 colours - first one is white as you don't want it shown on the chart:</span>
<span class="no">colours</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#FFFFFF"</span>, <span class="st">"#1B927D"</span>, <span class="st">"#006182"</span>, <span class="st">"#4D6594"</span>, <span class="st">"#D2D1C7"</span>, <span class="st">"#A7B0B6"</span>,
             <span class="st">"#D59F68"</span>, <span class="st">"#E9A225"</span>, <span class="st">"#A7A917"</span>, <span class="st">"#09A659"</span>, <span class="st">"#77B5B5"</span>, <span class="st">"#3277AC"</span>,
             <span class="st">"#234389"</span>, <span class="st">"#6B2865"</span>, <span class="st">"#C51A4A"</span>)


<span class="co"># Plot chart</span>
<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span><span class="kw">=</span><span class="no">Key</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">OBS_VALUE</span>, <span class="kw">x</span><span class="kw">=</span><span class="no">grouping</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.line.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.title.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.title.y</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.ticks</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">plot.caption</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">position</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_stack.html">position_stack</a></span>(<span class="kw">reverse</span> <span class="kw">=</span> <span class="fl">TRUE</span>), <span class="kw">stat</span><span class="kw">=</span><span class="st">"identity"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="no">colours</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_reverse</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Labour market summary, "</span>, <span class="no">area_of_interest_name</span>,
                      <span class="st">", January 2019 to December 2019."</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"right"</span>)

<span class="no">p</span></pre></body></html></div>
<p><img src="Introduction-to-work-and-health-nomis-indicators_files/figure-html/Stacked_Bar-1.png" width="700"></p>
</div>
<div id="pie-charts-showing-economic-activity-in-bolton" class="section level3">
<h3 class="hasAnchor">
<a href="#pie-charts-showing-economic-activity-in-bolton" class="anchor"></a>Pie charts showing economic activity in Bolton</h3>
<p>The following steps show how to make pie charts, which will show:</p>
<p>Pie 1: Economic activity of ‘Healthy’ working age population (16-64 years)</p>
<ul>
<li>Employment rate - aged 16-64 [id=45]</li>
<li>Unemployment rate - aged 16-64 [id=84]</li>
<li>% who are economically inactive - aged 16-64 [id=111]</li>
</ul>
<p>Pie 2: Economic activity of 16+ population with health conditions &amp; illnesses lasting more than 12 months</p>
<ul>
<li>% In employment with health conditions or illnesses lasting more than 12 months (16+) [id=1715]</li>
<li>% Unemployed with health conditions or illnesses lasting more than 12 months (16+) [id=1716]</li>
<li>% Inactive with health conditions or illnesses lasting more than 12 months (16+) [id=1717]</li>
</ul>
<p>The data extracted is for all of the geographies outlined in the ‘EN_geographies’ vector, but the chart is filtered for Bolton only.</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="co"># Economic activity of the 'healthy' working age population (16-64): Pie 1</span>

<span class="co"># Save variables needed as a vector:</span>
<span class="no">pie_vars</span> <span class="kw">&lt;-</span> <span class="no">NM_17_5_VARIABLE</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">pie</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="no">id</span> <span class="kw">==</span> <span class="fl">45</span>, <span class="fl">1</span>,
                       <span class="fu">if_else</span>(<span class="no">id</span> <span class="kw">==</span> <span class="fl">84</span>, <span class="fl">1</span>,
                               <span class="fu">if_else</span>(<span class="no">id</span> <span class="kw">==</span> <span class="fl">111</span>, <span class="fl">1</span>,
                                       <span class="fu">if_else</span>(<span class="no">id</span> <span class="kw">==</span> <span class="fl">1715</span>, <span class="fl">1</span>,
                                               <span class="fu">if_else</span>(<span class="no">id</span> <span class="kw">==</span> <span class="fl">1716</span>, <span class="fl">1</span>,
                                                       <span class="fu">if_else</span>(<span class="no">id</span> <span class="kw">==</span> <span class="fl">1717</span>, <span class="fl">1</span>, <span class="fl">0</span> ))))))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">pie</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">id</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pull</span>(<span class="no">id</span>)

<span class="co"># get data for pie</span>
<span class="no">pie_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_17_5"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>,
                           <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">variable</span> <span class="kw">=</span> <span class="no">pie_vars</span>,
                           <span class="kw">measures</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20599</span>, <span class="fl">21001</span>, <span class="fl">21002</span>, <span class="fl">21003</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>, <span class="no">VARIABLE_NAME</span>,
         <span class="no">VARIABLE_CODE</span>, <span class="no">MEASURES_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   DATE_TYPECODE = col_double(),
##   DATE_SORTORDER = col_double(),
##   GEOGRAPHY = col_double(),
##   GEOGRAPHY_TYPECODE = col_double(),
##   GEOGRAPHY_SORTORDER = col_double(),
##   VARIABLE = col_double(),
##   VARIABLE_CODE = col_double(),
##   VARIABLE_TYPECODE = col_double(),
##   VARIABLE_SORTORDER = col_double(),
##   MEASURES = col_double(),
##   OBS_VALUE = col_double(),
##   OBS_CONF = col_logical(),
##   RECORD_OFFSET = col_double(),
##   RECORD_COUNT = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="co"># replace na with 0</span>
<span class="no">pie_data</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">pie_data</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>

<span class="co"># create the groupings for the two pie charts:</span>
<span class="no">pie_data</span> <span class="kw">&lt;-</span> <span class="no">pie_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">MEASURES_NAME</span> <span class="kw">==</span> <span class="st">"Variable"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">group</span> <span class="kw">=</span> <span class="no">VARIABLE_CODE</span>,
         <span class="kw">group</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">group</span>))

<span class="no">pie_data</span> <span class="kw">&lt;-</span> <span class="no">pie_data</span>[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="no">pie_data</span>$<span class="no">group</span>),]

<span class="no">pie_data</span>$<span class="no">group</span>[<span class="no">pie_data</span>$<span class="no">group</span> <span class="kw">==</span> <span class="fl">45</span>] <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">pie_data</span>$<span class="no">group</span>[<span class="no">pie_data</span>$<span class="no">group</span> <span class="kw">==</span> <span class="fl">84</span>] <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">pie_data</span>$<span class="no">group</span>[<span class="no">pie_data</span>$<span class="no">group</span> <span class="kw">==</span> <span class="fl">111</span>] <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">pie_data</span>$<span class="no">group</span>[<span class="no">pie_data</span>$<span class="no">group</span> <span class="kw">==</span> <span class="fl">1715</span>] <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">pie_data</span>$<span class="no">group</span>[<span class="no">pie_data</span>$<span class="no">group</span> <span class="kw">==</span> <span class="fl">1716</span>] <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">pie_data</span>$<span class="no">group</span>[<span class="no">pie_data</span>$<span class="no">group</span> <span class="kw">==</span> <span class="fl">1717</span>] <span class="kw">&lt;-</span> <span class="fl">2</span>

<span class="no">pie_data</span> <span class="kw">&lt;-</span> <span class="no">pie_data</span> <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY_NAME</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">GEOGRAPHY_CODE</span>, <span class="no">VARIABLE_NAME</span>,
         <span class="no">OBS_VALUE</span>, <span class="no">group</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">pie_data</span>)</pre></body></html></div>
<pre><code>## # A tibble: 2,076 x 7
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE VARIABLE_NAME OBS_VALUE
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;             &lt;dbl&gt;
##  1 Jan 2019…    1.95e9 Adur           E07000223      Employment r…      90.4
##  2 Jan 2019…    1.95e9 Adur           E07000223      Unemployment…       0  
##  3 Jan 2019…    1.95e9 Adur           E07000223      % who are ec…       9.6
##  4 Jan 2019…    1.95e9 Adur           E07000223      % In employm…      47.4
##  5 Jan 2019…    1.95e9 Adur           E07000223      % Unemployed…       0  
##  6 Jan 2019…    1.95e9 Adur           E07000223      % Inactive w…      52.6
##  7 Jan 2019…    1.95e9 Allerdale      E07000026      Employment r…      83.7
##  8 Jan 2019…    1.95e9 Allerdale      E07000026      Unemployment…       3.4
##  9 Jan 2019…    1.95e9 Allerdale      E07000026      % who are ec…      13.3
## 10 Jan 2019…    1.95e9 Allerdale      E07000026      % In employm…      49.6
## # … with 2,066 more rows, and 1 more variable: group &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="co"># Have all the data to create the pie charts</span>

<span class="co"># Filter to area of interest and first pie data:</span>
<span class="no">pie1_data</span> <span class="kw">&lt;-</span> <span class="no">pie_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">GEOGRAPHY_CODE</span> <span class="kw">==</span> <span class="no">area_of_interest_code</span>,
         <span class="no">group</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">Key</span> <span class="kw">=</span> <span class="no">VARIABLE_NAME</span>)

<span class="no">area_of_interest_name</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">pie1_data</span>[<span class="fl">1</span>,<span class="st">"GEOGRAPHY_NAME"</span>])

<span class="co"># Sort out category names</span>
<span class="no">pie1_data</span>$<span class="no">Key</span>[<span class="no">pie1_data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% who are economically inactive - aged 16-64"</span>] <span class="kw">&lt;-</span> <span class="st">"Economically inactive"</span>
<span class="no">pie1_data</span>$<span class="no">Key</span>[<span class="no">pie1_data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"Employment rate - aged 16-64"</span>] <span class="kw">&lt;-</span> <span class="st">"In employment"</span>
<span class="no">pie1_data</span>$<span class="no">Key</span>[<span class="no">pie1_data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"Unemployment rate - aged 16-64"</span>] <span class="kw">&lt;-</span> <span class="st">"Unemployment"</span>

<span class="no">pie1_data</span> <span class="kw">&lt;-</span> <span class="no">pie1_data</span> <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">Key</span>)

<span class="co">#creating a pie chart using ggplot</span>
<span class="no">pie1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pie1_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">OBS_VALUE</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">Key</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span><span class="kw">=</span><span class="st">"identity"</span>, <span class="kw">width</span><span class="kw">=</span><span class="fl">1</span>)

<span class="no">pie1</span> <span class="kw">=</span> <span class="no">pie1</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span>(<span class="st">"y"</span>, <span class="kw">start</span><span class="kw">=</span><span class="fl">0</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">label</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">OBS_VALUE</span>, <span class="st">"%"</span>)),
            <span class="kw">position</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_stack.html">position_stack</a></span>(<span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">0.5</span>))

<span class="co"># Choose colours for the slides</span>
<span class="no">pie1</span> <span class="kw">=</span> <span class="no">pie1</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#862633"</span>,<span class="st">"#00AB8E"</span>,<span class="st">"#01216A"</span>))

<span class="no">pie1</span> <span class="kw">=</span> <span class="no">pie1</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="kw">NULL</span>,
                   <span class="kw">title</span> <span class="kw">=</span> (<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Participation in the labour market, "</span>,
                                   <span class="no">area_of_interest_name</span>, <span class="st">",
                                   January 2019 to December 2019"</span>)),
                   <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Working age population (16-64)"</span>)


<span class="co"># Tidy up the theme</span>
<span class="no">pie1</span> <span class="kw">=</span> <span class="no">pie1</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.line</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.ticks</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">12</span>),
        <span class="kw">plot.subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>))

<span class="no">pie1</span></pre></body></html></div>
<p><img src="Introduction-to-work-and-health-nomis-indicators_files/figure-html/Pie_Charts-1.png" width="700"></p>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="co"># Economic activity of the 16+ population with health conditions &amp; illnesses lasting more than 12 months: Pie 2</span>

<span class="co">#Filter to correct area and second pie data</span>
<span class="no">pie2_data</span> <span class="kw">&lt;-</span> <span class="no">pie_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">GEOGRAPHY_CODE</span> <span class="kw">==</span> <span class="no">area_of_interest_code</span>,
         <span class="no">group</span> <span class="kw">==</span> <span class="fl">2</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">Key</span> <span class="kw">=</span> <span class="no">VARIABLE_NAME</span>)

<span class="no">area_of_interest_name</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">pie2_data</span>[<span class="fl">1</span>,<span class="st">"GEOGRAPHY_NAME"</span>])

<span class="co"># Sort out category names:</span>
<span class="no">pie2_data</span>$<span class="no">Key</span>[<span class="no">pie2_data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% In employment with health conditions or illnesses lasting more than 12 months (aged 16+)"</span>] <span class="kw">&lt;-</span> <span class="st">"In employment"</span>
<span class="no">pie2_data</span>$<span class="no">Key</span>[<span class="no">pie2_data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% Inactive with health conditions or illnesses lasting more than 12 months (aged 16+)"</span>] <span class="kw">&lt;-</span> <span class="st">"Economically inactive"</span>
<span class="no">pie2_data</span>$<span class="no">Key</span>[<span class="no">pie2_data</span>$<span class="no">Key</span> <span class="kw">==</span> <span class="st">"% Unemployed with health conditions or illnesses lasting more than 12 months (aged 16+)"</span>] <span class="kw">&lt;-</span> <span class="st">"Unemployment"</span>

<span class="no">pie2_data</span> <span class="kw">&lt;-</span> <span class="no">pie2_data</span> <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">Key</span>)

<span class="co">#creating a pie chart using ggplot</span>

<span class="no">pie2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">pie2_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">OBS_VALUE</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">Key</span>))+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="kw">stat</span><span class="kw">=</span><span class="st">"identity"</span>, <span class="kw">width</span><span class="kw">=</span><span class="fl">1</span>)

<span class="no">pie2</span> <span class="kw">=</span> <span class="no">pie2</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span>(<span class="st">"y"</span>, <span class="kw">start</span><span class="kw">=</span><span class="fl">0</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">label</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">OBS_VALUE</span>, <span class="st">"%"</span>)), <span class="kw">position</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_stack.html">position_stack</a></span>(<span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">0.5</span>))

<span class="co">#using phe colours for the slices</span>
<span class="no">pie2</span> <span class="kw">=</span> <span class="no">pie2</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#862633"</span>,<span class="st">"#00AB8E"</span>,<span class="st">"#01216A"</span>))

<span class="no">pie2</span> <span class="kw">=</span> <span class="no">pie2</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">title</span> <span class="kw">=</span> (<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Participation in the labour market, "</span>, <span class="no">area_of_interest_name</span>, <span class="st">", January 2019 to December 2019"</span>)), <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Working age population with conditions or illnesses lasting more than 12 months"</span>)


<span class="co"># Tidy up the theme</span>
<span class="no">pie2</span> <span class="kw">=</span> <span class="no">pie2</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.line</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.text</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">axis.ticks</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
        <span class="kw">plot.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">12</span>),
        <span class="kw">plot.subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>))

<span class="no">pie2</span></pre></body></html></div>
<p><img src="Introduction-to-work-and-health-nomis-indicators_files/figure-html/Pie_Charts-2.png" width="700"></p>
</div>
<div id="treemap-showing-esa-claimants-by-specific-conditions-in-bolton" class="section level3">
<h3 class="hasAnchor">
<a href="#treemap-showing-esa-claimants-by-specific-conditions-in-bolton" class="anchor"></a>Treemap showing ESA claimants by specific conditions in Bolton</h3>
<p>The following steps show how to create a treemap:</p>
<ul>
<li>Step 1: Identify which conditions contribute the most to ESA claimants and rank them</li>
<li>Step 2: Extract conditions to map on to treemap and create appropriate age-groups</li>
<li>Step 3: Join two tables together to identify highest contributary conditions</li>
</ul>
<p>The data extracted is for all of the geographies outlined in the ‘EN_geographies’ vector, but the chart is filtered for Bolton only.</p>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="co"># Step 1: Contribution of conditions to total ESA claims</span>

<span class="co"># get ESA data by condition for latest data, call object ESA_data_condition</span>
<span class="co"># Note: the 'totals' (ID = 0) isn't the sum of the values in the dataset - hence hasn't been included in the code:</span>
<span class="no">ESA_data_condition</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_134_1"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>, <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">icdgp_condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">23</span>),
                                     <span class="kw">sex</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">esa_phase</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">payment_type</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">ethnic_group</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">8</span>),
                                     <span class="kw">duration</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fl">20100</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   DATE = col_character(),
##   DATE_NAME = col_character(),
##   DATE_CODE = col_character(),
##   DATE_TYPE = col_character(),
##   GEOGRAPHY_NAME = col_character(),
##   GEOGRAPHY_CODE = col_character(),
##   GEOGRAPHY_TYPE = col_character(),
##   ICDGP_CONDITION_NAME = col_character(),
##   ICDGP_CONDITION_TYPE = col_character(),
##   SEX_NAME = col_character(),
##   SEX_TYPE = col_character(),
##   ESA_PHASE_NAME = col_character(),
##   ESA_PHASE_TYPE = col_character(),
##   PAYMENT_TYPE_NAME = col_character(),
##   PAYMENT_TYPE_TYPE = col_character(),
##   ETHNIC_GROUP_NAME = col_character(),
##   ETHNIC_GROUP_TYPE = col_character(),
##   AGE_NAME = col_character(),
##   AGE_TYPE = col_character(),
##   DURATION_NAME = col_character()
##   # ... with 7 more columns
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="co"># replace na with 0</span>
<span class="no">ESA_data_condition</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">ESA_data_condition</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>

<span class="co"># Calculate total for each condition (i.e. all ages)</span>
<span class="no">ESA_data_condition</span> <span class="kw">&lt;-</span> <span class="no">ESA_data_condition</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">GEOGRAPHY_CODE</span>, <span class="no">ICDGP_CONDITION</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">total</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">OBS_VALUE</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>: <span class="no">GEOGRAPHY_CODE</span>, <span class="no">ICDGP_CONDITION</span>: <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">SEX_NAME</span>, <span class="no">total</span>) <span class="kw">%&gt;%</span>
  <span class="fu">distinct</span>(<span class="no">total</span>, <span class="kw">.keep_all</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Total for each area</span>
<span class="no">ESA_total</span> <span class="kw">&lt;-</span> <span class="no">ESA_data_condition</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">GEOGRAPHY</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">tot</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">total</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">GEOGRAPHY</span>: <span class="no">GEOGRAPHY_CODE</span>, <span class="no">tot</span>) <span class="kw">%&gt;%</span>
  <span class="fu">distinct</span>(<span class="no">tot</span>, <span class="kw">.keep_all</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Link the two tables together to calculate the percentage contributed</span>
<span class="no">ESA_total_final</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">ESA_data_condition</span>, <span class="no">ESA_total</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GEOGRAPHY_CODE"</span>, <span class="st">"GEOGRAPHY_NAME"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>: <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">SEX_NAME</span>, <span class="no">total</span>, <span class="no">tot</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">PERC</span> <span class="kw">=</span> <span class="no">total</span> / <span class="no">tot</span> *<span class="fl">100</span>,
         <span class="kw">PERC</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">PERC</span>, <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY_CODE</span>, <span class="fu">desc</span>(<span class="no">PERC</span>))
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ESA_total_final</span>)</pre></body></html></div>
<pre><code>## # A tibble: 7,958 x 10
## # Groups:   GEOGRAPHY_CODE, ICDGP_CONDITION [7,958]
##    DATE_NAME GEOGRAPHY.x GEOGRAPHY_NAME GEOGRAPHY_CODE ICDGP_CONDITION
##    &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                    &lt;dbl&gt;
##  1 November…  1946157059 Hartlepool     E06000001                    5
##  2 November…  1946157059 Hartlepool     E06000001                   13
##  3 November…  1946157059 Hartlepool     E06000001                   18
##  4 November…  1946157059 Hartlepool     E06000001                    6
##  5 November…  1946157059 Hartlepool     E06000001                    9
##  6 November…  1946157059 Hartlepool     E06000001                   10
##  7 November…  1946157059 Hartlepool     E06000001                    2
##  8 November…  1946157059 Hartlepool     E06000001                   19
##  9 November…  1946157059 Hartlepool     E06000001                   21
## 10 November…  1946157059 Hartlepool     E06000001                   11
## # … with 7,948 more rows, and 5 more variables: ICDGP_CONDITION_NAME &lt;chr&gt;,
## #   SEX_NAME &lt;chr&gt;, total &lt;dbl&gt;, tot &lt;dbl&gt;, PERC &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="co"># Remove factors from the above table &amp; rank them based on highest to lowest</span>
<span class="co"># Can then use this as a lookup for the treemap and which conditions to plot</span>
<span class="no">ESA_condition_rank</span> <span class="kw">&lt;-</span> <span class="no">ESA_total_final</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">ICDGP_CONDITION</span> <span class="kw">!=</span> <span class="fl">21</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY_CODE</span>, <span class="fu">desc</span>(<span class="no">PERC</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">GEOGRAPHY_CODE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">rank</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu">n</span>()) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">GEOGRAPHY_CODE</span>, <span class="no">GEOGRAPHY_NAME</span>, <span class="no">ICDGP_CONDITION</span>: <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">rank</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ESA_condition_rank</span>)</pre></body></html></div>
<pre><code>## # A tibble: 7,612 x 5
## # Groups:   GEOGRAPHY_CODE [346]
##    GEOGRAPHY_CODE GEOGRAPHY_NAME ICDGP_CONDITION ICDGP_CONDITION_NAME       rank
##    &lt;chr&gt;          &lt;chr&gt;                    &lt;dbl&gt; &lt;chr&gt;                     &lt;int&gt;
##  1 E06000001      Hartlepool                   5 Mental and behavioural d…     1
##  2 E06000001      Hartlepool                  13 Diseases of the musculos…     2
##  3 E06000001      Hartlepool                  18 Symptoms, signs and abno…     3
##  4 E06000001      Hartlepool                   6 Diseases of the nervous …     4
##  5 E06000001      Hartlepool                   9 Diseases of the circulat…     5
##  6 E06000001      Hartlepool                  10 Diseases of the respirat…     6
##  7 E06000001      Hartlepool                   2 Neoplasms                     7
##  8 E06000001      Hartlepool                  19 Injury, poisoning and ce…     8
##  9 E06000001      Hartlepool                  11 Diseases of the digestiv…     9
## 10 E06000001      Hartlepool                   4 Endocrine, nutritional a…    10
## # … with 7,602 more rows</code></pre>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="co"># Step 2: Extract conditions to map on to treemap and create appropriate age-groups</span>

<span class="co"># get ESA data by condition for latest data </span>
<span class="co"># Don't need the total (ID=0), factors (ID=21), Codes for special purposes (ID=22), Claimants without any diagnosis (ID=23)</span>
<span class="no">treemap_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/nomis_get_data.html">nomis_get_data</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"NM_134_1"</span>, <span class="kw">date</span> <span class="kw">=</span> <span class="st">"latest"</span>, <span class="kw">geography</span> <span class="kw">=</span> <span class="no">EN_geographies</span>, <span class="kw">icdgp_condition</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">19</span>),
                               <span class="kw">sex</span> <span class="kw">=</span> <span class="fl">7</span>, <span class="kw">esa_phase</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">payment_type</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">ethnic_group</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">age</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">8</span>),
                               <span class="kw">duration</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">measures</span> <span class="kw">=</span> <span class="fl">20100</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>: <span class="no">GEOGRAPHY_CODE</span>, <span class="no">ICDGP_CONDITION</span>: <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">SEX_NAME</span>, <span class="no">AGE</span>:<span class="no">AGE_NAME</span>, <span class="no">OBS_VALUE</span>)</pre></body></html></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   DATE = col_character(),
##   DATE_NAME = col_character(),
##   DATE_CODE = col_character(),
##   DATE_TYPE = col_character(),
##   GEOGRAPHY_NAME = col_character(),
##   GEOGRAPHY_CODE = col_character(),
##   GEOGRAPHY_TYPE = col_character(),
##   ICDGP_CONDITION_NAME = col_character(),
##   ICDGP_CONDITION_TYPE = col_character(),
##   SEX_NAME = col_character(),
##   SEX_TYPE = col_character(),
##   ESA_PHASE_NAME = col_character(),
##   ESA_PHASE_TYPE = col_character(),
##   PAYMENT_TYPE_NAME = col_character(),
##   PAYMENT_TYPE_TYPE = col_character(),
##   ETHNIC_GROUP_NAME = col_character(),
##   ETHNIC_GROUP_TYPE = col_character(),
##   AGE_NAME = col_character(),
##   AGE_TYPE = col_character(),
##   DURATION_NAME = col_character()
##   # ... with 7 more columns
## )
## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb66"><html><body><pre class="r"><span class="co"># replace na with 0</span>
<span class="no">treemap_data</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">treemap_data</span>)] <span class="kw">&lt;-</span> <span class="fl">0</span>

<span class="co"># Create appropriate age-groups i.e. 16-24, 25-34, 35-44, 45-54, 55-64</span>
<span class="no">agegrp1</span> <span class="kw">&lt;-</span> <span class="no">treemap_data</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">NEW_AGE</span> <span class="kw">=</span> <span class="no">AGE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">NEW_AGE</span>)

<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="st">"16-24yrs"</span>
<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="st">"16-24yrs"</span>
<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">3</span>] <span class="kw">&lt;-</span> <span class="st">"25-34yrs"</span>
<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">4</span>] <span class="kw">&lt;-</span> <span class="st">"35-44yrs"</span>
<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">5</span>] <span class="kw">&lt;-</span> <span class="st">"45-54yrs"</span>
<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">6</span>] <span class="kw">&lt;-</span> <span class="st">"45-54yrs"</span>
<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">7</span>] <span class="kw">&lt;-</span> <span class="st">"55-64yrs"</span>
<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span>[<span class="no">agegrp1</span>$<span class="no">NEW_AGE</span> <span class="kw">==</span> <span class="fl">8</span>] <span class="kw">&lt;-</span> <span class="st">"55-64yrs"</span>

<span class="co">#Calculate observations based on new age-bands:</span>
<span class="no">treemap_data_final</span> <span class="kw">&lt;-</span> <span class="no">agegrp1</span> <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY</span>, <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">NEW_AGE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">GEOGRAPHY</span>, <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">NEW_AGE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">OBS</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">OBS_VALUE</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">DATE_NAME</span>, <span class="no">GEOGRAPHY</span>: <span class="no">GEOGRAPHY_CODE</span>, <span class="no">ICDGP_CONDITION</span>: <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">SEX_NAME</span>, <span class="no">NEW_AGE</span>, <span class="no">OBS</span>) <span class="kw">%&gt;%</span>
  <span class="fu">distinct</span>(<span class="no">GEOGRAPHY</span>, <span class="no">ICDGP_CONDITION_NAME</span>, <span class="no">NEW_AGE</span>, <span class="kw">.keep_all</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">treemap_data_final</span>)</pre></body></html></div>
<pre><code>## # A tibble: 32,870 x 9
## # Groups:   GEOGRAPHY, ICDGP_CONDITION_NAME, NEW_AGE [32,870]
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE ICDGP_CONDITION
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                    &lt;dbl&gt;
##  1 November…    1.85e9 Greater Manch… E47000001                   16
##  2 November…    1.85e9 Greater Manch… E47000001                   16
##  3 November…    1.85e9 Greater Manch… E47000001                   16
##  4 November…    1.85e9 Greater Manch… E47000001                   16
##  5 November…    1.85e9 Greater Manch… E47000001                   16
##  6 November…    1.85e9 Greater Manch… E47000001                    1
##  7 November…    1.85e9 Greater Manch… E47000001                    1
##  8 November…    1.85e9 Greater Manch… E47000001                    1
##  9 November…    1.85e9 Greater Manch… E47000001                    1
## 10 November…    1.85e9 Greater Manch… E47000001                    1
## # … with 32,860 more rows, and 4 more variables: ICDGP_CONDITION_NAME &lt;chr&gt;,
## #   SEX_NAME &lt;chr&gt;, NEW_AGE &lt;chr&gt;, OBS &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb68"><html><body><pre class="r"><span class="co"># Will need to arrange it based on the highest conditions</span>

<span class="co"># Step 3: Join two tables together to identify highest contributary conditions:</span>
<span class="no">treemap_ranked</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">treemap_data_final</span>, <span class="no">ESA_condition_rank</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GEOGRAPHY_CODE"</span>, <span class="st">"GEOGRAPHY_NAME"</span>, <span class="st">"ICDGP_CONDITION"</span>, <span class="st">"ICDGP_CONDITION_NAME"</span>))

<span class="co"># Conditions that have a 1-7 rank should be included in the treemap - rest can be filtered out</span>
<span class="no">treemap</span> <span class="kw">&lt;-</span> <span class="no">treemap_ranked</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">rank</span> <span class="kw">==</span> <span class="fl">1</span> <span class="kw">|</span> <span class="no">rank</span> <span class="kw">==</span> <span class="fl">2</span> <span class="kw">|</span> <span class="no">rank</span> <span class="kw">==</span> <span class="fl">3</span> <span class="kw">|</span> <span class="no">rank</span> <span class="kw">==</span> <span class="fl">4</span> <span class="kw">|</span> <span class="no">rank</span> <span class="kw">==</span> <span class="fl">5</span> <span class="kw">|</span> <span class="no">rank</span> <span class="kw">==</span> <span class="fl">6</span> <span class="kw">|</span> <span class="no">rank</span> <span class="kw">==</span> <span class="fl">7</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">GEOGRAPHY_CODE</span>, <span class="no">rank</span>)

<span class="co"># Sort out the labels for the treemap:</span>
<span class="no">treemap</span> <span class="kw">&lt;-</span> <span class="no">treemap</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">CHART_LABS</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">NEW_AGE</span>, <span class="no">OBS</span>),
         <span class="kw">CON_SHORT</span> <span class="kw">=</span> <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Certain conditions originating in the perinatal period"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Perinatal conditions"</span>,
                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Certain infections and parasitic diseases"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Infectious diseases"</span>,
                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Congenital malformations, deformations and chromosomal abnormalities"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Congenital malformations"</span>,
                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the blood and blood forming organs and certain diseases involving the immune mechansim"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Blood-related conditions"</span>,
                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the circulatory system"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Circulatory"</span>,
                                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the digestive system"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Digestive"</span>,
                                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the ear and mastoid process"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Ear"</span>,
                                                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the eye and adnexa"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Eye"</span>,
                                                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the genito-urinary system"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Genito-urinary conditions"</span>,
                                                                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the musculoskeletal system and connective tissue"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Musculoskeletal conditions"</span>,
                                                                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the nervous system"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Nervous"</span>,
                                                                                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the respiratory system"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Respiratory"</span>,
                                                                                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Diseases of the skin and subcutaneous system"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Skin"</span>,
                                                                                                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Endocrine, nutritional and metabolic disease"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Endocrine &amp; metabolic diseases"</span>,
                                                                                                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Injury, poisoning and certain other consequences of external causes"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Injuries &amp; poisoning"</span>,
                                                                                                                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Mental and behavioural disorders"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Mental health conditions"</span>,
                                                                                                                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Neoplasms"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Cancer"</span>,
                                                                                                                                                             <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Pregnancy, childbirth and the puerperium"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Pregnancy &amp; childbirth"</span>,
                                                                                                                                                                     <span class="fu">if_else</span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Symptoms, signs and abnormal clinical and laboratory findings, not elsewhere classified"</span>, <span class="no">ICDGP_CONDITION_NAME</span>) <span class="kw">==</span> <span class="fl">TRUE</span>, <span class="st">"Symptoms &amp; abnormalities"</span>, <span class="st">"None"</span>))))))))))))))))))))



<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">treemap</span>)</pre></body></html></div>
<pre><code>## # A tibble: 12,110 x 12
## # Groups:   GEOGRAPHY, ICDGP_CONDITION_NAME, NEW_AGE [12,110]
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE ICDGP_CONDITION
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                    &lt;dbl&gt;
##  1 November…    1.95e9 Hartlepool     E06000001                    5
##  2 November…    1.95e9 Hartlepool     E06000001                    5
##  3 November…    1.95e9 Hartlepool     E06000001                    5
##  4 November…    1.95e9 Hartlepool     E06000001                    5
##  5 November…    1.95e9 Hartlepool     E06000001                    5
##  6 November…    1.95e9 Hartlepool     E06000001                   13
##  7 November…    1.95e9 Hartlepool     E06000001                   13
##  8 November…    1.95e9 Hartlepool     E06000001                   13
##  9 November…    1.95e9 Hartlepool     E06000001                   13
## 10 November…    1.95e9 Hartlepool     E06000001                   13
## # … with 12,100 more rows, and 7 more variables: ICDGP_CONDITION_NAME &lt;chr&gt;,
## #   SEX_NAME &lt;chr&gt;, NEW_AGE &lt;chr&gt;, OBS &lt;dbl&gt;, rank &lt;int&gt;, CHART_LABS &lt;chr&gt;,
## #   CON_SHORT &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb70"><html><body><pre class="r"><span class="co"># Filter to area of interest:</span>
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">treemap</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">GEOGRAPHY_CODE</span> <span class="kw">==</span> <span class="no">area_of_interest_code</span>) <span class="kw">%&gt;%</span>
  <span class="fu">arrange</span>(<span class="no">rank</span>, <span class="fu">desc</span>(<span class="no">OBS</span>))
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">data</span>)</pre></body></html></div>
<pre><code>## # A tibble: 35 x 12
## # Groups:   GEOGRAPHY, ICDGP_CONDITION_NAME, NEW_AGE [35]
##    DATE_NAME GEOGRAPHY GEOGRAPHY_NAME GEOGRAPHY_CODE ICDGP_CONDITION
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                    &lt;dbl&gt;
##  1 November…    1.95e9 Bolton         E08000001                    5
##  2 November…    1.95e9 Bolton         E08000001                    5
##  3 November…    1.95e9 Bolton         E08000001                    5
##  4 November…    1.95e9 Bolton         E08000001                    5
##  5 November…    1.95e9 Bolton         E08000001                    5
##  6 November…    1.95e9 Bolton         E08000001                   13
##  7 November…    1.95e9 Bolton         E08000001                   13
##  8 November…    1.95e9 Bolton         E08000001                   13
##  9 November…    1.95e9 Bolton         E08000001                   13
## 10 November…    1.95e9 Bolton         E08000001                   13
## # … with 25 more rows, and 7 more variables: ICDGP_CONDITION_NAME &lt;chr&gt;,
## #   SEX_NAME &lt;chr&gt;, NEW_AGE &lt;chr&gt;, OBS &lt;dbl&gt;, rank &lt;int&gt;, CHART_LABS &lt;chr&gt;,
## #   CON_SHORT &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb72"><html><body><pre class="r"><span class="no">area_of_interest_name</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">data</span>[<span class="fl">1</span>,<span class="st">"GEOGRAPHY_NAME"</span>])


<span class="co"># Get unique condition names:</span>
<span class="no">cond_names</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">data</span>$<span class="no">CON_SHORT</span>)

<span class="co"># Specify colours for each category in the order of preference. </span>
<span class="no">cat_colours</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#822433"</span>, <span class="st">"#00B092"</span>, <span class="st">"#002776"</span>, <span class="st">"#EAAB00"</span>, <span class="st">"#E9994A"</span>, <span class="st">"#A4AEB5"</span>, <span class="st">"#DAD7CB"</span>)
<span class="no">cat_colours</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">cat_colours</span>, <span class="kw">levels</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#822433"</span>, <span class="st">"#00B092"</span>, <span class="st">"#002776"</span>, <span class="st">"#EAAB00"</span>, <span class="st">"#E9994A"</span>, <span class="st">"#A4AEB5"</span>, <span class="st">"#DAD7CB"</span>))

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">treemapify</span>)

<span class="no">t</span> <span class="kw">&lt;-</span> <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">data</span>, <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">area</span> <span class="kw">=</span> <span class="no">OBS</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">CON_SHORT</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="no">CHART_LABS</span>,  <span class="kw">subgroup</span> <span class="kw">=</span> <span class="no">ICDGP_CONDITION_NAME</span>, <span class="kw">subgroup2</span> <span class="kw">=</span> <span class="no">NEW_AGE</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/treemapify/man/geom_treemap.html">geom_treemap</a></span>() +
  <span class="fu"><a href="https://rdrr.io/pkg/treemapify/man/geom_treemap_text.html">geom_treemap_text</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"white"</span>, <span class="kw">place</span> <span class="kw">=</span> <span class="st">"bottomleft"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">cat_colours</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"top"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.title</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>()) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Conditions recorded as being the primary reason for ESA claim, "</span>, <span class="no">area_of_interest_name</span>, <span class="st">", November 2018"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">""</span>))

<span class="no">t</span></pre></body></html></div>
<p><img src="Introduction-to-work-and-health-nomis-indicators_files/figure-html/Treemap-1.png" width="700"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://evanodell.com">Evan Odell</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
